<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
    <!-- Heritage de vue sur les projets pour afficher les estimation et autres fichiers de LAO -->
    <record id="ao_projet_form" model="ir.ui.view">
      <field name="name">project.project.form</field>
      <field name="model">project.project</field>
      <field name="inherit_id" ref="project.edit_project"/>
      <field name="arch" type="xml">

        <field name="partner_id" position="after">
          <newline/>
          <field name="date_begin" on_change="delayer(date_begin, date_end)"/>
          <newline/>
          <field name="date_end" on_change="delayer(date_begin, date_end)"/>
          <newline/>
          <field name="delai" />
          <newline/>
          <field name="Provisional_date" />
          <newline/>
          <field name="final_date" />
        </field>

        <p attrs="{'invisible': [('analytic_account_id','=',False)]}" position="replace">
          <field name="note" nolabel='1' placeholder="Description" on_change="save_note(note)" widget="html"/>
        </p>

        <sheet string="Project" position="before">
          <style>
             .openerp .oe_form_sheetbg {
              padding: 16px 0;
              max-width: none !important;
              }
             .openerp .oe_form_sheet_width_wider {
               max-width: 1100px;
            }
          </style>
        </sheet>
        <sheet string="Project" position="attributes">
          <attribute name="class">oe_form_sheet_width_wider</attribute>
        </sheet>
        <page string="Team" name="team" position="before">

          <page string="Award prizes">
            <field name="lot_id" nolabel="1" widget="one2many_list" attrs="{'readonly': [('state','in', ['cancel','reject'])]}">
              <tree string="Award prizes" editable="bottom" default_order="code asc">
                <field name="code"/>
                <field name="lot_name"/>
                <field name="caution" sum="Caution total"/>
                <field name="date_caution"/>
                <field name="credit_line" sum="Credit total"/>
                <field name="dqe" sum="DQE"/>
              </tree>
            </field>
          </page>

          <page string="Estimates">
            <field name="estimation_id" nolabel="1" widget="one2many_list" >
              
              <form string="Estimates">
                <group col="2">
                  <group col="6" colspan="2">
                    <field name="sequences" required="1"/>
                    <field name="type" colspan="2" on_change="lot_for_tender()"/>
                    <field name="parent_id" options="{'no_open': True,'no_create': 1, 'no_create_edit': 1}"/> <!-- domain a ajouter pour filter uniquement les parents liÃ© au tender -->
                  </group>
                  
                  <group col="4" colspan="2">
                    <field name="code"/>
                    <field name="lot_id" options="{'no_open': True,'no_create': 1, 'no_create_edit': 1}"/>
                  </group>
                  <group col="2">
                    <field name="price_line" colspan="2"/>
                  </group>
                  
                  <group col="4" colspan="2" >
                    <field name="unite_id" attrs="{'invisible': [('type','in','vue')]}"/>
                     <field name="quantity"  attrs="{'invisible': [('type','in','vue')], 'required': [('type','not in','vue')]}" />
                  </group>
                  
                  <newline/>
                  <group colspan="2">
                    <field name="mat_line" colspan="2" nolabel="1" widget="one2many_list" attrs="{'invisible': [('type','in','vue')], 'required': [('type','not in','vue')]}">
                      <tree string="Materials lines" editable="bottom" default_order="product_id asc">
                        <field name="product_id" />
                        <field name="pu_composant" />
                        <field name="unite_id"/>
                        <field name="quantity" />
                        <field name="mat_total" sum="Amount DS"/>
                      </tree>
                    </field>
                  </group>
                 
                  <group colspan="2" class="oe_subtotal_footer oe_right" attrs="{'invisible': [('type','in','vue')]}">
                    <field name="pu_ds" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'required': [('type','not in','vue')]}" />
                    <field name="coef" />
                    <field name="bpu" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'required': [('type','not in','vue')]}" />
                      <field name="total_ds" invisible="1" />
                      <field name="total_bpu" invisible="1"/>
                      <field name="ecart" invisible="1"/>
                      <field name="rent" invisible="1"/>
                      
                  </group>
                </group>
              </form>

              <tree default_order="sequences asc" colors="blue:type=='vue'" >
                <field name="type" invisible="1" />
                <field name="sequences" invisible="1"/>
                <field name="code"/>
                <field name="lot_id"/>
                <field name="price_line" />
                <field name="mat_line" invisible="1"/> <!-- tester si possible mettre en many2many pour afficher plusieurs ligne de prix -->
                <field name="unite_id"  />
                <field name="quantity" attrs="{'invisible': [('type','in','vue')]}"/>
                <field name="pu_ds" attrs="{'invisible': [('type','in','vue')]}" />
                <field name="total_ds" attrs="{'invisible': [('type','in','vue')]}" sum='Total DS'/>
                <field name="bpu" attrs="{'invisible': [('type','in','vue')]}" />
                <field name="total_bpu" attrs="{'invisible': [('type','in','vue')]}" sum='Total DQE'/>
              </tree>
            </field>
          </page>

          <page string="Documents received">
            <field name="doc_rec" nolabel="1" widget="one2many_list" >
              <tree string="Documents received" editable="bottom" default_order="name asc" >
                <field name="name" />
                <field name="datas"/>
                <field name="date"/>
              </tree>
            </field>
          </page>

          <page string="Submission documents" >
            <field name="doc_send" nolabel="1" widget="one2many_list" >
              <tree string="Documents sended" editable="bottom" default_order="name asc" >
                <field name="name"/>
                <field name="datas"/>
                <field name="date"/>
              </tree>
            </field>
          </page>

        </page>
        
      </field>
    </record>
  







  <!-- vue download report-->
    <record id="xls_form" model="ir.ui.view">
      <field name="name">xls.form</field>
      <field name="model" >gao.xls.report.file</field>
      <field name="arch" type="xml">
        <form string="Export file" version="7.0">
          <group>
            <label string="SAVE the File with '.xls' extension."/>
            <field name="file_name" invisible="1" />
            <field name="file" readonly="1" filename="file_name" nolabel="1" />
          </group>
          <footer>
            <button string="Close" class="oe_highlight" special="cancel" />
          </footer>
        </form>
      </field>
    </record>

  <!-- vue liste -->
    <record id="ap_gao_tree" model="ir.ui.view">
      <field name="name">ap.gao.tree</field>
      <field name="model">ap.gao</field>
      <field name="arch" type="xml">
        <tree string="Tender" colors="blue:state=='draft';red:state=='cancel'" >
                <field name="code" />
                <field name="name"/>
                <field name="owner"/>
                <field name="masterwork"/>
                <field name="type"/>
                <field name="state" />

        </tree>
      </field>
    </record>
<!-- vue formulaire -->
    <record id="ap_gao_form" model="ir.ui.view">
      <field name="name">ap.gao.form</field>
      <field name="model" >ap.gao</field>
      <field name="arch" type="xml">
        <form string="Tender" >
          <header>

            <field name="project_id" invisible="1"/>
            <!-- etat brouillon -->
            <button string="Validate" type="object" name="poster" class="oe_highlight" attrs="{'invisible': [('state','!=','draft')]}"/>
            <!-- etat consultation -->
            <button string="Validate" type="object" name="accord" class="oe_highlight" attrs="{'invisible': [('state','!=','cons')]}"/>
            <!-- etat planning -->
            <button string="Submission" type="object" name="submited" class="oe_highlight" attrs="{'invisible': [('state','!=','plan')]}"/>
            <button string="DQE.xls" type="object" name="print_dqexls" attrs="{'invisible': [('state','!=','plan')]}"/>
            <!-- etat soumission -->
            <button string="Accepted" type="object" name="accepted" class="oe_highlight" attrs="{'invisible': [('state','!=','submit')]}"/>
            <button string="Reject" type="object" name="rejected" class="oe_highlight" attrs="{'invisible': [('state','!=','submit')]}"/>
            <!-- etat accepted -->
            <button string="Create project" type="object" name="create_project" class="oe_highlight" attrs="{'invisible': [('state','!=','accept')]}"/>
            <button string="Create project et afficher" type="object" name="create_project" class="oe_highlight" attrs="{'invisible': [('state','!=','accept')]}" context="{'open_project':'open_project'}"/>
            <button string="Open Project" type="object" name="affiche" class="oe_highlight" attrs="{'invisible': [('state','!=','accepted')]}" context="{'open_project': project_id}"/>
            <!-- etat canceled -->
            <button string="Give the draft" type="object" name="draft" class="oe_highlight" attrs="{'invisible': [('state','!=','cancel')]}"/>

            <button string="Cancel" type="object" name="cancel" attrs="{'invisible': [('state','in',['draft','cancel','accepted'])]}"/>
            <button string="Cancel" type="object" name="canceled" confirm="Are you sure? because the event related project is also deleted." attrs="{'invisible': [('state','not in','accepted')]}" context="{'open_project': project_id}"/>

            <field name="state" widget="statusbar" statusbar_visible="cons,plan,submit,accept" statusbar_colors="{'accept': 'green','Reject':'red','cancel':'red'}"/>
            
          </header>
          <style>
             .openerp .oe_form_sheetbg {
              padding: 16px 0;
              max-width: none !important;
              }
             .openerp .oe_form_sheet_width_wider {
               max-width: 1100px;
            }
            
          </style>

          <sheet class="oe_form_sheet_width_wider">
            <group col="2" >
              <group col="2">
                <field name="code" attrs="{'readonly': [('state','in', ['cancel','reject'])]}"/>
              </group>
              <newline/>
              <h1 colspan="2"><field name="name" placeholder="Tender title" attrs="{'readonly': [('state','in', ['cancel','reject'])]}"/></h1>
              
              <group col="2" string="Customer" >
                <field name="owner" attrs="{'readonly': [('state','in', ['cancel','reject'])]}"/>
                <field name="owner_contact" />

                <field name="masterwork" attrs="{'readonly': [('state','in', ['cancel','reject'])]}"/>
                <field name="master_address" />
                <field name="master_contact" /> 
              </group>
              <group col="2" string="Tender Processus">
                <field name="type" attrs="{'readonly': [('state','in', ['cancel','reject'])]}"/>
                <field name="date_meeting" attrs="{'readonly': [('state','in', ['cancel', 'reject'])]}"/>
                <field name="date_depot" attrs="{'readonly': [('state','in',['cancel', 'reject'])]}"/>
                <field name="owner_address" attrs="{'readonly': [('state','in',['cancel', 'reject'])]}"/>
                <field name="copy" attrs="{'readonly': [('state','in',['cancel', 'reject'])]}"/>
                <field name="date_ouvert" attrs="{'readonly': [('state','in',['cancel', 'reject'])]}"/>
                <field name="date_begin" on_change="delayer(date_begin, date_end)" attrs="{'readonly': [('state','in',['cancel','draft', 'cons', 'plan', 'submit', 'reject'])]}"  />
                <field name="date_end" on_change="delayer(date_begin, date_end)" attrs="{'readonly': [('state','in',['cancel','draft', 'cons', 'plan', 'submit', 'reject'])]}" />
                <field name="delai"/>
              </group>
                           
              <!--<group col="4" string="Values" colspan="2" >
                <field name="market"/>
                <field name="total_ds"/>
              </group>-->
              <notebook string="Processus" colspan="2">
                
                <page string="Award prizes">
                  <separator string="Award prizes" />
                    <field name="lot_id" nolabel="1" widget="one2many_list" attrs="{'readonly': [('state','in', ['cancel','reject'])]}">
                      <tree string="Award prizes" editable="bottom" default_order="code asc">
                        <field name="code"/>
                        <field name="lot_name"/>
                        <field name="caution" sum="Caution total"/>
                        <field name="credit_line" sum="Credit total"/>
                      </tree>
                    </field>
                </page>
                
                <page string="Estimates" attrs="{'invisible': [('state','in',['draft', 'cons'])]}">
                  <separator string="Estimates" />
                   <!-- <field name="id" /> -->
                    <field name="estimation_id" nolabel="1" widget="one2many_list" attrs="{'readonly': [('state','in', ['cancel','reject'])]}" context="{'tender': id}" >
                     <form string="Estimates">
                        <group col="2">
                          <group col="6" colspan="2">
                            <field name="sequences" required="1"/>
                            <field name="type" colspan="2" on_change="lot_for_tender()"/>
                            <field name="parent_id" options="{'no_open': True,'no_create': 1, 'no_create_edit': 1}"/> <!-- domain a ajouter pour filter uniquement les parents liÃ© au tender -->
                          </group>
                          
                          <group col="4" colspan="2">
                            <field name="code"/>
                            <field name="lot_id" options="{'no_open': True,'no_create': 1, 'no_create_edit': 1}"/>
                          </group>
                          <group col="2">
                            <field name="price_line" colspan="2"/>
                          </group>
                          
                          <group col="4" colspan="2" >
                            <field name="unite_id" attrs="{'invisible': [('type','in','vue')]}"/>
                             <field name="quantity"  attrs="{'invisible': [('type','in','vue')], 'required': [('type','not in','vue')]}" />
                          </group>
                          
                          <newline/>
                          <group colspan="2">
                            <field name="mat_line" colspan="2" nolabel="1" widget="one2many_list" attrs="{'invisible': [('type','in','vue')], 'required': [('type','not in','vue')]}">
                              <tree string="Materials lines" editable="bottom" default_order="product_id asc">
                                <field name="product_id" required="1"/>
                                <field name="pu_composant" />
                                <field name="unite_id"/>
                                <field name="quantity"  />
                                <field name="mat_total" sum="Amount DS"/>
                              </tree>
                            </field>
                          </group>
                         
                          <group colspan="2" class="oe_subtotal_footer oe_right" attrs="{'invisible': [('type','in','vue')]}">
                            <field name="pu_ds" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'required': [('type','not in','vue')]}" />
                              <field name="coef" string="K" required="1"/>
                            <field name="bpu" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'required': [('type','not in','vue')]}" style="width:100%"/>
                              <field name="total_ds" invisible="1" />
                              <field name="total_bpu" invisible="1"/>
                              <field name="ecart" invisible="1"/>
                              <field name="rent" invisible="1"/>
                          </group>
                        </group>
                    </form>

                      <tree default_order="sequences asc" colors="blue:type=='vue'" >
                        <field name="type" invisible="1" />
                        <field name="sequences" />
                        <field name="code"/>
                        <field name="lot_id"/>
                        <field name="price_line"/>
                        <field name="mat_line" invisible="1"/> <!-- tester si possible mettre en many2many pour afficher plusieurs ligne de prix -->
                        <field name="unite_id"  />
                        <field name="quantity" attrs="{'invisible': [('type','in','vue')]}"/>
                        <field name="pu_ds" attrs="{'invisible': [('type','in','vue')]}" />
                        <field name="total_ds" attrs="{'invisible': [('type','in','vue')]}"/>
                        <field name="coef" attrs="{'invisible': [('type','in','vue')]}"/>
                        <field name="bpu" attrs="{'invisible': [('type','in','vue')]}" />
                        <field name="total_bpu" attrs="{'invisible': [('type','in','vue')]}"/>
                        <field name="ecart" attrs="{'invisible': [('type','in','vue')]}"/>
                        <field name="rent" attrs="{'invisible': [('type','in','vue')]}" />
                        
                      </tree>

                    </field>
                        <b><group class="oe_subtotal_footer ">
                            <button name="dummy" states="draft,cons,plan,submit"
                                        string="(update)" class="oe_link oe_edit_only"
                                        type="object" help="save type parent" colspan="2"/>
                                        <newline/>                       
                            <field name="amount_ht_ds" />
                            <field name="amount_ht_dqe" />
                        </group></b>
                    
                </page>


                <page string="Documents received" attrs="{'invisible': [('state','in',['draft', 'cons'])]}">
                  <separator string="Documents received" />
                    <field name="doc_rec" nolabel="1" widget="one2many_list" attrs="{'readonly': [('state','in', ['cancel','reject'])]}">
                      <tree string="Documents received" editable="bottom" default_order="name asc" >
                        <field name="name" />
                        <field name="type" invisible="1"/>
                        <field name="datas"/>
                        <field name="date"/>
                        <field name="status" invisible="1"/>
                      </tree>
                    </field>
                </page>

                <page string="Submission documents" attrs="{'invisible': [('state','in',['draft', 'cons'])]}">
                  <separator string="Documents sended" />
                    <field name="doc_send" nolabel="1" widget="one2many_list" attrs="{'readonly': [('state','in', ['cancel','reject'])]}">
                      <tree string="Documents sended" editable="bottom" default_order="name asc" >
                        <field name="name"/>
                        <field name="type" invisible="1"/>
                        <field name="datas"/>
                        <field name="date"/>
                        <field name="status" invisible="1"/>
                      </tree>
                    </field>
                </page>

                <page string="Description">
                  <separator string="Description" attrs="{'readonly': [('state','in', ['cancel','reject'])]}"/>
                  <field name="note" attrs="{'readonly': [('state','in', ['cancel','reject'])]}" on_change="save_note(note)" widget="html"/>
                </page>
              </notebook>
            </group>
          </sheet>
        </form>
      </field>
    </record>



    <!-- L'action du menu -->
    <record model="ir.actions.act_window" id="action_ap_gao_draft">
      <field name="name">Tender</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">ap.gao</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="ap_gao_tree"/>
      <field name="domain">[('state', 'in', ['draft', 'cons', 'cancel','reject'])]</field>
      <field name="context">{"search_default_filter_see_all":1}</field>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">
          Click here to create a customer bidding.
        </p>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_ap_gao_approved">
      <field name="name">Tender</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">ap.gao</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="ap_gao_tree"/>
      <field name="domain">[('state', 'not in', ['draft', 'cons', 'cancel', 'accept', 'accepted'])]</field>
      <field name="context">{"search_default_filter_see_all":1}</field>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">
          Click here to create a customer bidding.
        </p>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_ap_gao_accept">
      <field name="name">Tender</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">ap.gao</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="ap_gao_tree"/>
      <field name="domain">[('state', 'in', ['accept', 'accepted'])]</field>
      <field name="context">{"search_default_filter_see_all":1}</field>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">
          Click here to create a customer bidding.
        </p>
      </field>
    </record>

    <!-- Menu gauche  etudiant -->   
    <menuitem
            name="Tenders"
            id="menu_tender"
            />

    <menuitem
            name="Tenders"
            id="menu_ap_gao"
            parent="menu_tender"
            />
    <menuitem
            name="Proposal"
            id="menu_action_ap_gao_draft"
            action="action_ap_gao_draft"
            parent="menu_ap_gao"
            sequence="1"
            />
    <menuitem
            name="Subscription"
            id="menu_action_ap_gao_approved"
            action="action_ap_gao_approved"
            parent="menu_ap_gao"
            sequence="2"
            />
    <menuitem
            name="Accepted"
            id="menu_action_ap_gao_accept"
            action="action_ap_gao_accept"
            parent="menu_ap_gao"
            sequence="3"
            />
     <!-- <menuitem
            name="Voir"
            id="menu_action_ap_pac_update"
            
            parent="menu_action_ap_pac_student"
            />
   # -->
    
  </data>
</openerp>
